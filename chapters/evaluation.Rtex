\chapter{Model evaluation}
\label{ch:evaluation}

In chapter~\ref{ch:model}, I presented a theoretical model for seating behavior
of train passengers.
The model is implemented in the crowd simulation software \vadere.
More information on the implementation is provided in chapter~\ref{ch:software},
more specifically in the sections~\ref{sec:traingen},
\ref{sec:model-implementation}, and~\ref{sec:model-verification}.

In this chapter, I evaluate the seating model.
First, I verify that the model's algorithm works as expected by comparing
simulation output against empirical data collected in
section~\ref{sec:data-collection}.
Second, I visually validate the model by analyzing a series of screenshots of
the simulated scenario.

\section{Model verification}
\label{sec:evaluation-model-verification}

In this section, I verify the seating model's algorithm by comparing simulation
output against real data on seating behavior.
This is a higher-level test of the model implementation that complements the
unit tests described in section~\ref{sec:model-implementation}.

I let the simulation generate data in exactly the same format as the collected
data.
Section~\ref{sec:data-collection} defines the data format and
section~\ref{sec:model-verification} describes how the data is generated.
%
I then apply the same procedure of data processing that I used for the collected
data to the simulated data.
The data processing is explained in section~\ref{sec:data-processing}.
%
In section~\ref{sec:model-data-analysis}, I analyzed the seating data and used
bar diagrams to guide the algorithm design.
In the following, I show these diagrams side by side with diagrams generated
from the simulated data.
I compare the bar diagrams visually for equivalence to verify that the algorithm
works as expected.
Another method would be to perform binomial tests on each pair of corresponding
relative frequencies.

<<echo=FALSE, include=FALSE>>=
#source('../../../seating-data/scripts/analysis.R', chdir = TRUE) # Already loaded
read_chunk('../../../seating-data/scripts/chunks-simulated-data.R')
@

<<chunk-simulated-data-processing, echo=FALSE, include=FALSE>>=
@

\subsection{Simulation run}

For the model verification, I simulate a realistic scenario using passenger
counts from statistics provided by the \acs{MVV}, one of Munich's organizations
for public transport (see section~\ref{sec:passenger-counts}).
The simulation reflects the situation on Friday, 2013-07-26, starting at
08:40\am\ in Deisenhofen on the \sbahn\ line S3.
% date -d yyyy-mm-dd
%hoki-mdorf-2013-07-26-08-40.txt
However, only passengers entering the train are simulated.
The simulation of passengers leaving is not covered by the seating model.

%\verb|[jakob:~/projects/VADERE/traingen] master* Â± awk -f stop-option-stats.awk < ../PersSchoettl/vadere_project/scenarios/train_scenario_with_mvv_counts.txt|

Data is generated by observing 11 compartments of the simulated train wagon
simultaneously.
The simulation was run 5 times, each time using a random seed for the
internal random number generator.
Each run stopped after
37~minutes\footnote{\verb|grep finishTime scenarios/train_scenario_with_mvv_counts.scenario|%
\shellcmdline}
(simulation time) when the train's seat capacity is exceeded.
The data of all observed compartments is then combined in one log event dataset.
This dataset has the same form as the dataset from the real data collections
(see section~\ref{subsec:data-format}).
The datasets for surveys and persons are artificially created from the log
event data.

\clearpage
\subsection{Choice of the seat group}

<<plot-verification-chosen-seat-group, echo=FALSE, out.width='45%', fig.align='center', fig.pos='H', fig.cap='People\'s preference for a seat group within a compartment: choosing one with the smallest number of other persons or any other.', fig.subcap=c('Simulated data.', 'Data from data collection.')>>=
plotChosenSeatGroupMin(seatingDataSimulated)
plotChosenSeatGroupMin(seatingData)
@

\clearpage % to have title and floats on same page
\subsection{Choice of a seat}

\subsubsection{Empty seat group}

<<plot-verification-seat-group-0-side, echo=FALSE, out.width='45%', fig.align='center', fig.pos='H', fig.cap='People\'s preference for window vs. aisle seats in an empty seat group.', fig.scap='People\'s preference for window vs. aisle seats in an empty seat group.', fig.subcap=c('Simulated data.', 'Data from data collection.')>>=
plotSeatGroup0Side(seatingDataSimulated)
plotSeatGroup0Side(seatingData)
@

<<plot-verification-seat-group-0-direction, echo=FALSE, out.width='45%', fig.align='center', fig.pos='H', fig.cap='People\'s preference for forward vs. backward-facing seats in an empty seat group.', fig.scap='People\'s preference for forward vs. backward-facing seats in an empty seat group.', fig.subcap=c('Simulated data.', 'Data from data collection.')>>=
plotSeatGroup0Direction(seatingDataSimulated)
plotSeatGroup0Direction(seatingData)
@

<<plot-verification-seat-group-0-side-direction, echo=FALSE, out.width='45%', fig.align='center', fig.pos='H', fig.cap='People\'s preference for a specific seat in an empty seat group. The abbreviations are combinations of the seat\'s side and facing direction. AIS and WIN stand for the aisle and window side, respectively. BF and FW stand for backward and forward-facing direction, respectively.', fig.subcap=c('Simulated data.', 'Data from data collection.')>>=
plotSeatGroup0SideDirection(seatingDataSimulated)
plotSeatGroup0SideDirection(seatingData)
@

\subsubsection{Seat group with one other person}

<<plot-verification-seat-group-1, echo=FALSE, out.width='45%', fig.align='center', fig.pos='H', fig.cap='People\'s preference for seat positions in a seat group with one other person. Possible positions are next to, across from, and diagonally across from the other person.', fig.subcap=c('Simulated data.', 'Data from data collection.')>>=
plotSeatGroup1(seatingDataSimulated)
plotSeatGroup1(seatingData)
@

\subsection{Assessment}

The preceding diagrams illustrate the most important rules in the model's
algorithm.
The clear matches within the pairs of plots show that the simulation results
reflect the model design.
It therefore can be concluded that the model's implementation works as expected
regarding the tested algorithm elements. % better elements of the algorithm?

However, the model verification does not prove that the model actually reflects
passengers' seating behavior correctly.
In the next section, I undertake a visual validation.

\section{Visual validation}

In this section a visual validation is conducted.
This validation is based on the same simulation described in
section~\ref{sec:evaluation-model-verification}.
Screenshots of the simulated train scenario are printed in
figure~\ref{fig:train-simulation}.
Each screenshot is taken after a train stop as soon as all new passengers have
sat down.
If the situations depicted in the pictures look realistic and if the simulated
passengers seem to choose their seats in a natural way, this is an indication
for a valid model.

\begin{figure}[htb]
  \centering
  \includegraphics[width=\linewidth]{train-simulation}
  %\includesvg{train-simulation.svg}
  \caption[Screenshots of a simulated train scenario.]{%
  This figure shows screenshots of a simulated train scenario.
  The train's moving direction is from right to left.
  For the simulation, passenger counts from the \sbahn\ line S3 to Mammendorf
  are used, starting at Deisenhofen.
  Above each screenshot, the train station is denoted after which the picture was taken.
  Picture (1) and (2) additionally show passengers' trajectories to visualize
  their ways.
  The green bars above the entrance areas are the sources where passengers come
  from.
  The extra, black border lines around the train are there to prevent simulated
  passengers from walking outside of the train towards their seats.
  Unfortunately, there are a few cases where passengers cannot reach their
  target.
  This is probably a flaw in the navigation model.
  }\label{fig:train-simulation}
\end{figure}

Screenshots (1) and (2) show passenger's trajectories.\footnote{
  There are no trajectories in later screenshots because there are too much
  passengers.
  Trajectories would be ambiguous and would clutter the pictures.}
These trajectories show that many passengers choose a compartment next to the
door they entered.
Other passengers walk through the train passing multiple compartments.
These results are expected as argued in section~\ref{subsec:model-assumptions}.

Within a compartment, the simulated passengers mostly choose the seat group with
the smallest number of other passengers.
This can be observed by comparing the same compartment in adjacent screenshots
or also by viewing all seat groups: the numbers of passengers sitting in seat
groups of a compartment are mostly similar.
This is behavior we expect in the German culture.

Within an empty seat group, the simulated passengers mostly choose
forward-facing or window-side seats, especially the forward-facing window seat.
This is expected according to experts at the \acs{MVV}\citemvv\ and also
supported by this and other studies (\eg \citet{rueger-2010}).

Within a seat group with one passenger, the seat diagonal across from that
passenger is most frequently chosen.
This is behavior we expect in the German culture because strangers tend to keep
distance to each other.

For seat groups with two passengers, the choices a new passenger has are too
complex to examine with this validation schema.
About these seat groups and those with only one available seat, it can be told
that they also fill up during the simulation, which is expected.

There are some problems evident in the screenshots of the simulation:
Some pedestrians stand in seat groups or in the aisle and are apparently unable
to sit down.
This is most probably a problem with the underlying pedestrian navigation model.
I examined debug logs and found that these pedestrians have a valid seat target
but never reach this target even if the seat is available.
Possible reasons might be problems with the floor field parameters
(section~\ref{subsec:floor-field-parameters}) or the discrete stepping
algorithms of the \acf{OSM}.

\FloatBarrier
\section{Summary}

In this chapter, I verified and validated the seating model based on a simulation
with real passenger counts.

For the model verification, train compartments in the simulation were observed
to collect the same kind of data as collected in the field study.
I then compared plots from both datasets pairwise, and found clear matches
between them.
This indicates that the seating model has a solid implementation.

For the model validation, I examined screenshots of the simulated scenario.
By comparing pairs of subsequent pictures and by checking single pictures for
consistency, I demonstrated that the seating model yields a natural looking
seating behavior.
